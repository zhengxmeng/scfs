1: 切换用户  su - oracle
2: 查看配置文件信息   vi .bach_profile


#创建并编辑
vi ordatabak.sh

#!/bin/bash
export ORACLE_BASE=/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0
export ORACLE_SID=apdb
export ORACLE_TERM=xterm
export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib
export LANG=C
export NLS_LANG=AMERICAN_AMERICA.AL32UTF8



#以上代码为Oracle数据库运行账号oracle的系统环境变量设置，必须添加，否则crontab任务计划不能执行。
date=`date +%Y_%m_%d`   #获取系统当前日期时间
days=10  #设置删除5天之前的备份文件
orsid=10.66.220.37:1521/apdb #Oracle数据库服务器IP、端口、SID
orowner=scfs  #备份此用户下面的数据
bakuser=scfs   #用此用户来执行备份，必须要有备份操作的权限
bakpass=scfs  #执行备注的用户密码
bakdir=/root/scfs_oracle_bf  #备份文件路径，需要提前创建好
bakdata=$orowner"_"$date.dmp #备份数据库名称
baklog=$orowner"_"$date.log #备份执行时候生成的日志文件名称
ordatabak=$orowner"_"$date.tar.gz #最后保存的Oracle数据库备份文件
cd $bakdir #进入备份目录
mkdir -p $orowner #按需要备份的Oracle用户创建目录
cd $orowner #进入目录
exp $bakuser/$bakpass@$orsid grants=y owner=$orowner file=$bakdir/$orowner/$bakdata log=$bakdir/$orowner/$baklog #执行备份
tar -zcvf $ordatabak $bakdata  $baklog  #压缩备份文件和日志文件
find $bakdir/$orowner  -type f -name "*.log" -exec rm {} \; #删除备份文件
find $bakdir/$orowner  -type f -name "*.dmp" -exec rm {} \; #删除日志文件
find $bakdir/$orowner  -type f -name "*.tar.gz" -mtime +$days -exec rm -rf {} \;  #删除5天前的备份



#!/bin/bash
export ORACLE_BASE=/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0
export ORACLE_SID=apdb
export ORACLE_TERM=xterm
export PATH=$ORACLE_HOME/bin:/usr/sbin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib
export LANG=C
export NLS_LANG=AMERICAN_AMERICA.AL32UTF8



#以上代码为Oracle数据库运行账号oracle的系统环境变量设置，必须添加，否则crontab任务计划不能执行。
date=`date +%Y_%m_%d`   #获取系统当前日期时间
echo $date
days=10  #设置删除5天之前的备份文件
orsid=127.0.0.1:1521/apdb #Oracle数据库服务器IP、端口、SID
orowner=scfs  #备份此用户下面的数据
bakuser=scfs   #用此用户来执行备份，必须要有备份操作的权限
bakpass=scfs  #执行备注的用户密码
bakdir=/home/scfs_oracle_bf  #备份文件路径，需要提前创建好
bakdata=$orowner"_"$date".dmp" #备份数据库名称
echo $bakdata
baklog=$orowner"_"$date.log #备份执行时候生成的日志文件名称
ordatabak=$orowner"_"$date.tar.gz #最后保存的Oracle数据库备份文件
cd $bakdir #进入备份目录
mkdir -p $orowner #按需要备份的Oracle用户创建目录
cd $orowner #进入目录
#exp $bakuser/$bakpass@$orsid file=$bakdir/$orowner/$bakdata  #执行备份
#find $bakdir/$orowner  -type f -name "*.dmp" -mtime +$days -exec rm -rf {} \;  #删除5天前的备份


#授权脚本执行权限
chmod +x ordatabak.sh 

编辑系统任务执行计划

crontab -e
输入一下信息：
00 03 * * * /backup/P_DATA/P_DB_BAK.sh #每天凌晨3点，以oracle用户执行P_DB_BAK.sh备份文件
:wq! #保存退出

#重启crontab

service crond restart


exp scfs/scfs@127.0.0.1:1521/apdb file=/home/scfs_oracle_bf/scfs/scfs_123.dmp log=/root/scfs_oracle_bf/scfs/scfs_23.log
exp scfs/scfs@10.66.220.37:1521/aqdb file=/home/scfs_oracle_bf/scfs/scfs_.dmp



/*第1步：创建临时表空间 */
create temporary tablespace root_temp 
tempfile '/home/oracle\scfs_01.dbf' 
size 20m 
autoextend on 
next 10m maxsize 20480m 
extent management local; 

/*第2步：创建数据表空间 */
create tablespace scfs_01 
logging 
datafile '/home/oracle\scfs_01.dbf' 
size 20m 
autoextend on 
next 10m maxsize 1024m 
extent management local; 

/*第3步：创建用户并指定表空间//第一个root是用户名，第二个是密码 */
create user scfs_01 identified by scfs_01 
default tablespace scfs_01
temporary tablespace scfs.dmp; 

/*第4步：给用户授予权限 */
grant connect,resource,dba to scfs_01;

alter database datafile '/home/oracle/scfs_test.dbf' offline drop;
alter database datafile '/home/oracle/scfs_test.dbf' offline drop;
alter database datafile '/home/oracle/scfs_test.dbf’ offline drop;

recover datafile '/home/oracle/scfs_test.dbf';
 drop tablespace scfs_test;
 drop tablespace scfs_test INCLUDING contents;
 alter database datafile '/home/oracle/scfs_test.dbf' offline drop
 drop tablespace scfs_test including contents;

